// mingo.js 1.3.3
// Copyright (c) 2017 Francis Asante
// https://github.com/kofrasa/mingo
// MIT
!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):n.mingo=t()}(this,function(){"use strict";function n(n,t){b(n)&&w(t)}function t(n){switch(e(n)){case mn:return n.map(t);case bn:return E(n,t);default:return n}}function r(n){return null===n?"Null":void 0===n?"Undefined":n.constructor.name}function e(n){return r(n).toLowerCase()}function u(n){return e(n)===pn}function i(n){return e(n)===gn}function o(n){return e(n)===dn}function a(n){return e(n)===mn}function s(n){return!p(n)&&O(n,"length")}function c(n){return e(n)===bn}function f(n){return n===Object(n)}function l(n){return e(n)===$n}function v(n){return e(n)===yn}function h(n){return e(n)===_n}function p(n){return d(n)||g(n)}function d(n){return e(n)===vn}function g(n){return e(n)===hn}function $(n,t){return n.includes(t)}function y(n,t){return!n.includes(t)}function m(n){return!!n}function b(n){return!n}function _(n){return p(n)||a(n)&&0===n.length||c(n)&&0===j(n).length||!n}function x(n){return a(n)?n:[n]}function O(n,t){return n.hasOwnProperty(t)}function w(n){throw new Error(n)}function j(n){return Object.keys(n)}function k(n,t){n[Nn]=Object.assign(n[Nn]||{},t)}function N(n,t){return O(n,Nn)&&c(t)&&q(Object.assign({},n[Nn],t),n[Nn])}function M(n){O(n,Nn)&&delete n[Nn]}function A(t,r){var u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(n(t===Object(t),"Cannot iterate over object of type '"+e(t)+"'"),s(t))for(var i=0,o=t.length;i<o&&!1!==r.call(u,t[i],i,t);i++);else for(var a in t)if(O(t,a)&&!1===r.call(u,t[a],a,t))break}function E(n,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(a(n))return n.map(t,r);if(c(n)){var e={};return A(n,function(n,u){return e[u]=t.call(r,n,u)},n),e}}function S(n,t,r){return a(n)?n.reduce(t,r):(A(n,function(e,u){return r=t(r,e,u,n)}),r)}function I(n,t){return n.filter($.bind(null,t))}function T(n,t){return L(L([],n),t.filter(y.bind(null,n)))}function q(n,t){if(n===t)return!0;var r=e(n);if(r!==e(t)||r===_n)return!1;if(r===dn&&isNaN(n)&&isNaN(t))return!0;if($([$n,yn],r))return n.toString()===t.toString();if(r===mn){if(n.length===t.length&&0===n.length)return!0;if(n.length!==t.length)return!1;for(var u=0,i=n.length;u<i;u++)if(!q(n[u],t[u]))return!1}else{if(r!==bn)return R(n)===R(t);var o=j(n),a=j(t);if(o.length!==a.length)return!1;if(o.sort(),a.sort(),!q(o,a))return!1;for(var s=0,c=o.length;s<c;s++){var f=o[s];if(!q(n[f],t[f]))return!1}}return!0}function P(n){var t={},r=[];return A(n,function(n){var e=R(n);O(t,e)||(r.push(n),t[e]=0)}),r}function C(n){return(Math.E+Math.random()).toString(36).slice(2,n+2)}function D(n){var t=e(n);switch(t){case _n:return C(7);case pn:case dn:case yn:return n.toString();case gn:return JSON.stringify(n);case $n:return n.toISOString();case vn:case hn:return t;case mn:return"["+E(n,function(n){return""+D(n)})+"]";default:var u=t===bn?"":r(n)+"|",i=j(n);return i.sort(),u+"{"+E(i,function(t){return D(t)+":"+D(n[t])})+"}"}}function R(n){var t=0,r=void 0,e=void 0,u=void 0,i=D(n);if(0===i.length)return t;for(r=0,u=i.length;r<u;r++)e=i.charCodeAt(r),t=(t<<5)-t+e,t|=0;return t.toString()}function F(n,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,e={},u=[],i=n.length,o=[],a=0;a<i;a++){var s=n[a],c=t.call(r,s,a);if(p(c))o.push(s);else{var f=R(s);O(e,f)||(e[f]=[c,a]),u.push(s)}}return u.sort(function(n,t){var r=e[R(n)],u=e[R(t)];return r[0]<u[0]?-1:r[0]>u[0]?1:r[1]<u[1]?-1:r[1]>u[1]?1:0}),L(o,u)}function U(n,t,r){var e={keys:[],groups:[]},u={};return A(n,function(n){var i=t.call(r,n),o=R(i),a=-1;g(u[o])&&(a=e.keys.length,u[o]=a,e.keys.push(i),e.groups.push([])),a=u[o],e.groups[a].push(n)}),e}function L(n,t){return Array.prototype.push.apply(n,t),n}function B(n,t){for(var r=0,e=n.length-1;r<=e;){var u=Math.round(r+(e-r)/2);if(t<n[u])e=u-1;else{if(!(t>n[u]))return u;r=u+1}}return r}function Y(n){var t=this;return function(r){return function(){for(var e=arguments.length,u=Array(e),i=0;i<e;i++)u[i]=arguments[i];var o=R(u);return O(r,o)||(r[o]=n.apply(t,u)),r[o]}}({})}function J(t,r,e){if($(V(wn),r))return Mn[r](t,e);if(c(e)){var u={};return A(e,function(r,i){if(u[i]=J(t,i,e[i]),$(V(wn),i))return u=u[i],n(1===j(e).length,"Invalid $group expression '"+JSON.stringify(e)+"'"),!1}),u}}function z(t,r){return n(a(r),"Aggregation pipeline must be an array"),new qn(r).run(t)}function G(n,t,r){return new Rn(t).find(n,r)}function H(n,t){return new Rn(t).remove(n)}function Q(n,t){return new Array(Math.max(t-String(n).length+1,0)).join("0")+n}function V(){return S(arguments,function(n,t){return L(n,j(Wn[t]))},[])}function K(t,r){var e=r(ln());n(O(Wn,t),"Invalid operator class "+t);var i=Wn[t];A(e,function(r,e){n(/^\$\w+$/.test(e),"Invalid operator name "+e),n(!O(i,e),e+" already exists for '"+t+"' operators")});var o={};switch(t){case kn:A(e,function(n,t){o[t]=function(n,r){return function(e,i){return{test:function(o){var a=nn(o,e),s=n.call(r,e,a,i);return u(s)?s:s instanceof Rn?s.test(o):void w("Invalid return type for '"+t+"'. Must return a Boolean or Query")}}}}(n,e)});break;case jn:A(e,function(n,t){o[t]=function(n,t){return function(r,e,u){var i=nn(r,u);return n.call(t,u,i,e)}}(n,e)});break;default:A(e,function(n,t){o[t]=function(n,t){return function(){for(var r=arguments.length,e=Array(r),u=0;u<r;u++)e[u]=arguments[u];return n.apply(t,e)}}(n,e)})}Object.assign(Wn[t],o)}function W(n){Object.assign(Xn,n||{})}function X(){return Xn.key}function Z(n,t){return n[t]}function nn(n,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=t.split("."),u=n;n:for(var i=0;i<e.length;i++){var o=function(n){if(null===e[n].match(/^\d+$/)&&a(u)){if(!0===r&&0===n)return{v:u};u=u.map(function(t){return nn(t,e[n],!0)}),k(u,{isMulti:!0}),1===u.length&&(u=u[0])}else u=Z(u,e[n]),r=!1;if(p(u))return"break"}(i);switch(o){case"break":break n;default:if("object"===(void 0===o?"undefined":Sn(o)))return o.v}}return u}function tn(t,r){if(!p(t)){var e=r.split("."),u=e[0],i=1===e.length||e.slice(1).join("."),o=null!==u.match(/^\d+$/),s=e.length>1,c=void 0,f=void 0;try{a(t)?o?(c=Z(t,u),s&&(c=tn(c,i)),n(!g(c)),c=[c]):(c=[],A(t,function(n){f=tn(n,r),p(f)||c.push(f)}),n(c.length>0)):(f=Z(t,u),s&&(f=tn(f,i)),n(!g(f)),c={},c[u]=f)}catch(n){c=void 0}return c}}function rn(n,t,r){var e=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=t.split("."),i=u[0],o=1===u.length||u.slice(1).join(".");if(1===u.length)r(n,i);else if(a(n)&&!/^\d+$/.test(i))A(n,function(n){rn(n,t,r,e)});else{if(!0===e){var s=O(n,i);s&&!p(n[i])||(n[i]={})}rn(n[i],o,r,e)}}function en(n,t,r){rn(n,t,function(n,t){n[t]=r},!0)}function un(n,t){rn(n,t,function(n,t){a(n)&&/^\d+$/.test(t)?n.splice(parseInt(t),1):c(n)&&delete n[t]})}function on(n){if($(xn,e(n)))return v(n)?{$regex:n}:{$eq:n};if(f(n)){var t=j(n);if(0===I(V(kn),t).length)return{$eq:n};if($(t,"$regex")){var r=n.$regex,u=n.$options||"",o="";i(r)&&(o+=r.ignoreCase||u.indexOf("i")>=0?"i":"",o+=r.multiline||u.indexOf("m")>=0?"m":"",o+=r.global||u.indexOf("g")>=0?"g":"",r=new RegExp(r,o)),n.$regex=r,delete n.$options}}return n}function an(t,r){var u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(o.root=o.root||t,$(V(On),u))return Kn[u](t,r,o);if($(V(wn),u))return t=an(t,r,null,o),n(a(t),u+" expression must resolve to an array"),Mn[u](t,null,o);if(i(r)&&r.length>0&&"$"===r[0]){if($(tt,r))return Zn[r](t,null,o);if($(rt,r))return r;var s=tt.filter(function(n){return 0===r.indexOf(n+".")});return 1===s.length&&(s=s[0],"$$ROOT"===s&&(t=o.root),r=r.substr(s.length)),nn(t,r.slice(1))}switch(e(r)){case mn:return r.map(function(n){return an(t,n)});case bn:var c={};return A(r,function(e,u){if(c[u]=an(t,e,u,o),$(V(On,wn),u))return n(1===j(r).length,"Invalid aggregation expression '"+JSON.stringify(r)+"'"),c=c[u],!1}),c;default:return r}}function sn(t,r){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return p(e)?r<0?(r=Math.max(0,t.length+r),e=t.length-r+1):(e=r,r=0):(r<0&&(r=Math.max(0,t.length+r)),n(e>0,"Invalid argument value for $slice operator. Limit must be a positive number"),e+=r),Array.prototype.slice.apply(t,[r,e])}function cn(n){var t=S(n.data,function(n,t){return n+t},0),r=n.data.length||1,e=!0===n.sampled?1:0,u=t/(r-e);return Math.sqrt(S(n.data,function(n,t){return n+Math.pow(t-u,2)},0)/r)}function fn(n,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r.root=r.root||n;var e=an(n,t,null,r);return $(rt,e)?nt[e](n,t,r):e}function ln(){return{computeValue:an,idKey:X,ops:V,resolve:nn,assert:n,clone:t,each:A,err:w,getType:r,has:O,isArray:a,isBoolean:u,isDate:l,isEmpty:_,isEqual:q,isFunction:h,isNil:p,isNull:d,isNumber:o,isObject:c,isRegExp:v,isString:i,isUndefined:g,keys:j,map:E}}Function.prototype.bind||(Function.prototype.bind=function(n){if("function"!=typeof this)throw new Error("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),r=this,e=function(){},u=function(){return r.apply(this instanceof e?this:n,t.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(e.prototype=this.prototype),u.prototype=new e,u}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(n){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),r=t.length>>>0;if("function"!=typeof n)throw new TypeError("predicate must be a function");for(var e=arguments[1],u=0;u<r;){var i=t[u];if(n.call(e,i,u,t))return i;u++}}}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(n){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),r=t.length>>>0;if("function"!=typeof n)throw new TypeError("predicate must be a function");for(var e=arguments[1],u=0;u<r;){var i=t[u];if(n.call(e,i,u,t))return u;u++}return-1}}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(n,t){if(null==this)throw new TypeError('"this" is null or not defined');var r=Object(this),e=r.length>>>0;if(0===e)return!1;for(var u=0|t,i=Math.max(u>=0?u:e-Math.abs(u),0);i<e;){if(function(n,t){return n===t||"number"==typeof n&&"number"==typeof t&&isNaN(n)&&isNaN(t)}(r[i],n))return!0;i++}return!1}}),"function"!=typeof Object.assign&&(Object.assign=function(n,t){if(null==n)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(n),e=Array.prototype.slice.call(arguments),u=1;u<e.length;u++){var i=e[u];if(null!=i)for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])}return r}),Object.keys||(Object.keys=function(n){if(n!==Object(n))throw new TypeError("Object.keys called on a non-object");var t=[];for(var r in n)n.hasOwnProperty(r)&&t.push(r);return t}),Object.values||(Object.values=function(n){if(n!==Object(n))throw new TypeError("Object.values called on a non-object");var t=[];for(var r in n)n.hasOwnProperty(r)&&t.push(n[r]);return t});var vn="null",hn="undefined",pn="boolean",dn="number",gn="string",$n="date",yn="regexp",mn="array",bn="object",_n="function",xn=[vn,hn,pn,dn,gn,$n,yn],On="aggregate",wn="group",jn="projection",kn="query",Nn="__mingo__",Mn={$addToSet:function(n,t){return P(this.$push(n,t))},$sum:function(n,t){return a(n)?o(t)?n.length*t:S(this.$push(n,t).filter(o),function(n,t){return n+t},0):0},$max:function(n,t){return S(this.$push(n,t),function(n,t){return p(n)||t>n?t:n},void 0)},$min:function(n,t){return S(this.$push(n,t),function(n,t){return p(n)||t<n?t:n},void 0)},$avg:function(n,t){var r=this.$push(n,t).filter(o);return S(r,function(n,t){return n+t},0)/(r.length||1)},$push:function(n,t){return p(t)?n:E(n,function(n){return an(n,t)})},$first:function(n,t){return n.length>0?an(n[0],t):void 0},$last:function(n,t){return n.length>0?an(n[n.length-1],t):void 0},$stdDevPop:function(n,t){return cn({data:this.$push(n,t).filter(o),sampled:!1})},$stdDevSamp:function(n,t){return cn({data:this.$push(n,t).filter(o),sampled:!0})}},An={$:function(n,t,r){w("$ not implemented")},$elemMatch:function(n,t,r){var e=nn(n,r),u=new Rn(t);if(!p(e)&&a(e))for(var i=0;i<e.length;i++)if(u.test(e[i]))return[e[i]]},$slice:function(n,t,r){var e=nn(n,r);return a(e)?a(t)?sn(e,t[0],t[1]):o(t)?sn(e,t):void w("Invalid argument type for $slice projection operator"):e},$stdDevPop:function(n,t,r){return cn({data:an(n,t,r),sampled:!1})},$stdDevSamp:function(n,t,r){return cn({data:an(n,t,r),sampled:!0})}},En={$addFields:function(n,r){var e=j(r);return n.map(function(n){return n=t(n),A(e,function(t){var e=r[t],u=an(n,e);rn(n,t,function(n,t){n[t]=u},!0)}),n})},$group:function(n,t){var r=X(),e=t[r],u=U(n,function(n){return an(n,e,e)}),i=[];return delete t[r],A(u.keys,function(n,e){var o={};g(n)||(o[r]=n),A(t,function(n,t){o[t]=J(u.groups[e],t,n)}),i.push(o)}),i},$lookup:function(r,e){function u(n){return R(p(n)?null:n)}var o=e.from,s=e.localField,c=e.foreignField,f=e.as,l="Invalid $lookup expression. ";n(a(o),l+"'from' must be an array"),n(i(c),l+"'foreignField' must be a string"),n(i(s),l+"'localField' must be a string"),n(i(f),l+"'as' must be a string");var v=[],h={};if(o.length<=r.length)A(o,function(n,t){var r=u(n[c]);h[r]=h[r]||[],h[r].push(t)}),A(r,function(n){var r=u(n[s]),e=h[r]||[],i=t(n);i[f]=e.map(function(n){return t(o[n])}),v.push(i)});else{A(r,function(n,t){var r=u(n[s]);h[r]=h[r]||[],h[r].push(t)});var d={};A(o,function(n){var e=u(n[c]);A(h[e]||[],function(e){var u=d[e]||t(r[e]);u[f]=u[f]||[],u[f].push(t(n)),d[e]=u})});for(var g=0,$=j(d).length;g<$;g++)v.push(d[g])}return v},$match:function(n,t){return new Rn(t).find(n).all()},$project:function(r,e){if(_(e))return r;var u=[],a=j(e),s=!1,f=X(),l=[!1,!1];if(A(e,function(t,r){r!==f&&(0===t||!1===t?l[0]=!0:l[1]=!0,n(l[0]!==l[1],"Projection cannot have a mix of inclusion and exclusion."))}),$(a,f)){var v=e[f];0!==v&&!1!==v||(a=a.filter(y.bind(null,[f])),n(y(a,f),"Must not contain collections id key"),s=_(a))}else a.push(f);return A(r,function(n){var r={},l=!1,v=!1,h=[];s&&h.push(f),A(a,function(u){var a=e[u],s=void 0;if(u!==f&&0===a&&(v=!0),u===f&&_(a))s=n[u];else if(i(a))s=an(n,a,u);else if(1===a||!0===a);else{if(!c(a))return void h.push(u);var p=j(a);p=!(p.length>1)&&p[0],$(V(jn),p)?"$slice"===p?x(a[p]).every(o)?(s=An[p](n,a[p],u),l=!0):s=an(n,a,u):s=An[p](n,a[p],u):s=an(n,a,u)}var d=t(tn(n,u));g(d)||Object.assign(r,d),g(s)||en(r,u,t(s))}),(l||v||s)&&(r=Object.assign(t(n),r),A(h,function(n){return un(r,n)})),u.push(r)}),u},$limit:function(n,t){return n.slice(0,t)},$skip:function(n,t){return n.slice(t)},$unwind:function(r,e){var u=[],i=e.substr(1);return A(r,function(r){var e=Z(r,i);n(a(e),"Target field '"+i+"' is not of type Array."),A(e,function(n){var e=t(r);e[i]=n,u.push(e)})}),u},$sort:function(n,t){if(!_(t)&&c(t)){A(j(t).reverse(),function(r){var e=U(n,function(n){return nn(n,r)}),u={},i=function(n){return u[R(n)]},o=F(e.keys,function(n,t){return u[R(n)]=t,n});-1===t[r]&&o.reverse(),n=[],A(o,function(t){return L(n,e.groups[i(t)])})})}return n},$sortByCount:function(n,t){var r={count:{$sum:1}};return r[X()]=t,this.$sort(this.$group(n,r),{count:-1})},$sample:function(t,r){var e=r.size;n(o(e),"$sample size must be a positive integer");for(var u=[],i=t.length,a=0;a<e;a++){var s=Math.floor(Math.random()*i);u.push(t[s])}return u},$count:function(t,r){n(i(r)&&""!==r.trim()&&-1===r.indexOf(".")&&"$"!==r.trim()[0],"Invalid expression value for $count");var e={};return e[r]=t.length,e},$replaceRoot:function(t,r){var e=r.newRoot,u=[];return A(t,function(t){t=an(t,e),n(c(t),"$replaceRoot expression must return a valid JS object"),u.push(t)}),u},$redact:function(n,r){return n.map(function(n){return fn(t(n),r)})},$bucket:function(t,e){var u=e.boundaries,i=e.default,o=u[0],a=u[u.length-1],s=e.output||{count:{$sum:1}};n(u.length>2,"$bucket 'boundaries' expression must have at least 3 elements");for(var c=r(o),f=0,l=u.length-1;f<l;f++)n(c===r(u[f+1]),"$bucket 'boundaries' must all be of the same type"),n(u[f]<u[f+1],"$bucket 'boundaries' must be sorted in ascending order");p(i)||r(e.default)!==r(o)||n(o>e.default||a<e.default,"$bucket 'default' expression must be out of boundaries range");var v={};return A(u,function(n){return v[n]=[]}),p(i)||(v[i]=[]),A(t,function(t){var r=an(t,e.groupBy);if(p(r)||r<o||r>=a)n(!p(i),"$bucket require a default for out of range values"),v[i].push(t);else if(r>=o&&r<a){var s=B(u,r),c=u[Math.max(0,s-1)];v[c].push(t)}else w("$bucket 'groupBy' expression must resolve to a value in range of boundaries")}),u.pop(),p(i)||u.push(i),E(u,function(n){var t=J(v[n],null,s);return Object.assign(t,{_id:n})})},$bucketAuto:function(t,r){var e=r.output||{count:{$sum:1}},u=r.groupBy,i=r.buckets;n(i>0,"The $bucketAuto 'buckets' field must be greater than 0, but found: "+i);var o=Math.round(t.length/i);o<1&&(o=1);for(var a=Y(an),s={},c=[],f=F(t,function(n){var t=a(n,u);return p(t)?c.push(n):(s[t]||(s[t]=[]),s[t].push(n)),t}),l=X(),v=[],h=0,d=0,g=f.length;d<i&&h<g;d++){for(var $={},y=[],m=0;m<o&&h<g;m++){var b=a(f[h],u);if(p(b)&&(b=null),L(y,p(b)?c:s[b]),h+=p(b)?c.length:s[b].length,O($,"min")||($.min=b),v.length>0){v[v.length-1][l].max=$.min}}d==i-1&&L(y,f.slice(h)),v.push(Object.assign(J(y,null,e),{_id:$}))}return v.length>0&&(v[v.length-1][l].max=a(f[f.length-1],u)),v},$facet:function(n,t){return E(t,function(t){return z(n,t)})}},Sn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},In=function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")},Tn=function(){function n(n,t){for(var r=0;r<t.length;r++){var e=t[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,e.key,e)}}return function(t,r,e){return r&&n(t.prototype,r),e&&n(t,e),t}}(),qn=function(){function t(n){In(this,t),this.__operators=n}return Tn(t,[{key:"run",value:function(t,r){return _(this.__operators)||A(this.__operators,function(e){var u=j(e);n(1===u.length&&$(V("pipeline"),u[0]),"Invalid aggregation operator "+u),u=u[0],t=r&&r instanceof Rn?En[u].call(r,t,e[u]):En[u](t,e[u])}),t}}]),t}(),Pn=function(){function t(n,r,e){In(this,t),this.__query=r,this.__collection=n,this.__projection=e||r.__projection,this.__operators={},this.__result=!1,this.__position=0}return Tn(t,[{key:"_fetch",value:function(){var t=this;if(!1!==this.__result)return this.__result;c(this.__projection)&&Object.assign(this.__operators,{$project:this.__projection}),n(a(this.__collection),"Input collection is not of valid type. Must be an Array."),this.__result=this.__collection.filter(this.__query.test,this.__query);var r=[];if(A(["$sort","$skip","$limit","$project"],function(n){if(O(t.__operators,n)){var e={};e[n]=t.__operators[n],r.push(e)}}),r.length>0){var e=new qn(r);this.__result=e.run(this.__result,this.__query)}return this.__result}},{key:"all",value:function(){return this._fetch()}},{key:"first",value:function(){return this.count()>0?this._fetch()[0]:null}},{key:"last",value:function(){return this.count()>0?this._fetch()[this.count()-1]:null}},{key:"count",value:function(){return this._fetch().length}},{key:"skip",value:function(n){return Object.assign(this.__operators,{$skip:n}),this}},{key:"limit",value:function(n){return Object.assign(this.__operators,{$limit:n}),this}},{key:"sort",value:function(n){return Object.assign(this.__operators,{$sort:n}),this}},{key:"next",value:function(){return this.hasNext()?this._fetch()[this.__position++]:null}},{key:"hasNext",value:function(){return this.count()>this.__position}},{key:"max",value:function(n){return Mn.$max(this._fetch(),n)}},{key:"min",value:function(n){return Mn.$min(this._fetch(),n)}},{key:"map",value:function(n){return this._fetch().map(n)}},{key:"forEach",value:function(n){A(this._fetch(),n)}},{key:Symbol.iterator,value:function(){var n=this;return{next:function(){return n.hasNext()?{done:!1,value:n.next()}:{done:!0}}}}}]),t}(),Cn={$eq:function(n,t){if(q(n,t))return!0;if(p(n)&&p(t))return!0;if(a(n)){if(!N(n,{isMulti:!0}))return-1!==n.findIndex(q.bind(null,t));try{for(var r=0;r<n.length;r++)if(this.$eq(n[r],t))return!0}finally{M(n)}}return!1},$ne:function(n,t){return!this.$eq(n,t)},$in:function(n,t){return n=x(n),I(n,t).length>0},$nin:function(n,t){return p(n)||!this.$in(n,t)},$lt:function(n,t){return void 0!==(n=x(n).find(function(n){return n<t}))},$lte:function(n,t){return void 0!==(n=x(n).find(function(n){return n<=t}))},$gt:function(n,t){return void 0!==(n=x(n).find(function(n){return n>t}))},$gte:function(n,t){return void 0!==(n=x(n).find(function(n){return n>=t}))},$mod:function(n,t){return void 0!==(n=x(n).find(function(n){return o(n)&&a(t)&&2===t.length&&n%t[0]===t[1]}))},$regex:function(n,t){return void 0!==(n=x(n).find(function(n){return i(n)&&v(t)&&!!n.match(t)}))},$exists:function(n,t){return(!1===t||0===t)&&p(n)||(!0===t||1===t)&&!p(n)},$all:function(n,t){var r=!1;if(a(n)&&a(t))for(var e=0,u=t.length;e<u;e++){if(!c(t[e])||!$(j(t[e]),"$elemMatch"))return I(t,n).length===u;r=r||this.$elemMatch(n,t[e].$elemMatch)}return r},$size:function(n,t){return a(n)&&o(t)&&n.length===t},$elemMatch:function(n,t){if(a(n)&&!_(n))for(var r=new Rn(t),e=0,u=n.length;e<u;e++)if(r.test(n[e]))return!0;return!1},$type:function(n,t){switch(t){case 1:case"double":return o(n)&&-1!==(n+"").indexOf(".");case 2:case gn:return i(n);case 3:case bn:return c(n);case 4:case mn:return a(n);case 6:case hn:return p(n);case 8:case"bool":return u(n);case 9:case $n:return l(n);case 10:case vn:return d(n);case 11:case"regex":return v(n);case 16:case"int":return o(n)&&n<=2147483647&&-1===(n+"").indexOf(".");case 18:case"long":return o(n)&&n>2147483647&&n<=0x8000000000000000&&-1===(n+"").indexOf(".");case 19:case"decimal":return o(n);default:return!1}}},Dn={$and:function(t,r){n(a(r),"Invalid expression: $and expects value to be an Array");var e=[];return A(r,function(n){return e.push(new Rn(n))}),{test:function(n){for(var t=0;t<e.length;t++)if(!e[t].test(n))return!1;return!0}}},$or:function(t,r){n(a(r),"Invalid expression. $or expects value to be an Array");var e=[];return A(r,function(n){return e.push(new Rn(n))}),{test:function(n){for(var t=0;t<e.length;t++)if(e[t].test(n))return!0;return!1}}},$nor:function(t,r){n(a(r),"Invalid expression. $nor expects value to be an Array");var e=this.$or("$or",r);return{test:function(n){return!e.test(n)}}},$not:function(n,t){var r={};r[n]=on(t);var e=new Rn(r);return{test:function(n){return!e.test(n)}}},$where:function(n,t){return h(t)||(t=new Function("return "+t+";")),{test:function(n){return!0===t.call(n)}}}};A(Cn,function(n,t){Dn[t]=function(n,t){return function(r,e){return{test:function(u){var i=nn(u,r);return n.call(t,i,e)}}}}(n,Cn)});var Rn=function(){function t(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};In(this,t),this.__criteria=n,this.__projection=r,this.__compiled=[],this._compile()}return Tn(t,[{key:"_compile",value:function(){var t=this;if(!_(this.__criteria)){n(c(this.__criteria),"Criteria must be of type Object");var r=void 0;A(this.__criteria,function(n,e){"$where"===e?r={field:e,expr:n}:$(["$and","$or","$nor"],e)?t._processOperator(e,e,n):(n=on(n),A(n,function(n,r){t._processOperator(e,r,n)})),c(r)&&t._processOperator(r.field,r.field,r.expr)})}}},{key:"_processOperator",value:function(n,t,r){$(V(kn),t)?this.__compiled.push(Dn[t](n,r)):w("Invalid query operator '"+t+"' detected")}},{key:"test",value:function(n){for(var t=0,r=this.__compiled.length;t<r;t++)if(!this.__compiled[t].test(n))return!1;return!0}},{key:"find",value:function(n,t){return new Pn(n,this,t)}},{key:"remove",value:function(n){var t=this;return S(n,function(n,r){return t.test(r)||n.push(r),n},[])}}]),t}(),Fn={$abs:function(n,t){var r=an(n,t);return null===r||void 0===r?null:Math.abs(r)},$add:function(n,t){return S(an(n,t),function(n,t){return n+t},0)},$ceil:function(t,r){var e=an(t,r);return isNaN(e)?NaN:p(e)?null:(n(o(e),"$ceil must be a valid expression that resolves to a number."),Math.ceil(e))},$divide:function(n,t){var r=an(n,t);return r[0]/r[1]},$exp:function(t,r){var e=an(t,r);return isNaN(e)?NaN:p(e)?null:(n(o(e),"$exp must be a valid expression that resolves to a number."),Math.exp(e))},$floor:function(t,r){var e=an(t,r);return isNaN(e)?NaN:p(e)?null:(n(o(e),"$floor must be a valid expression that resolves to a number."),Math.floor(e))},$ln:function(t,r){var e=an(t,r);return isNaN(e)?NaN:p(e)?null:(n(o(e),"$ln must be a valid expression that resolves to a number."),Math.log(e))},$log:function(t,r){var e=an(t,r);return n(a(e)&&2===e.length,"$log must be a valid expression that resolves to an array of 2 items"),e.some(isNaN)?NaN:e.some(p)?null:(n(e.every(o),"$log expression must resolve to array of 2 numbers"),Math.log10(e[0])/Math.log10(e[1]))},$log10:function(t,r){var e=an(t,r);return isNaN(e)?NaN:p(e)?null:(n(o(e),"$log10 must be a valid expression that resolves to a number."),Math.log10(e))},$mod:function(n,t){var r=an(n,t);return r[0]%r[1]},$multiply:function(n,t){return S(an(n,t),function(n,t){return n*t},1)},$pow:function(t,r){var e=an(t,r);return n(a(e)&&2===e.length&&e.every(o),"$pow expression must resolve to an array of 2 numbers"),n(!(0===e[0]&&e[1]<0),"$pow cannot raise 0 to a negative exponent"),Math.pow(e[0],e[1])},$sqrt:function(t,r){var e=an(t,r);return isNaN(e)?NaN:p(e)?null:(n(o(e)&&e>0,"$sqrt expression must resolve to non-negative number."),Math.sqrt(e))},$subtract:function(n,t){var r=an(n,t);return r[0]-r[1]},$trunc:function(t,r){var e=an(t,r);return isNaN(e)?NaN:p(e)?null:(n(o(e)&&e>0,"$trunc must be a valid expression that resolves to a non-negative number."),Math.trunc(e))}},Un={$arrayElemAt:function(t,r){var e=an(t,r);n(a(e)&&2===e.length,"$arrayElemAt expression must resolve to an array of 2 elements"),n(a(e[0]),"First operand to $arrayElemAt must resolve to an array"),n(o(e[1]),"Second operand to $arrayElemAt must resolve to an integer");var u=e[1];return e=e[0],u<0&&Math.abs(u)<=e.length?e[u+e.length]:u>=0&&u<e.length?e[u]:void 0},$arrayToObject:function(t,r){var e=an(t,r);return n(a(e),"$arrayToObject expression must resolve to an array"),S(e,function(n,t){return a(t)&&2==t.length?n[t[0]]=t[1]:c(t)&&O(t,"k")&&O(t,"v")?n[t.k]=t.v:w("$arrayToObject expression is invalid."),n},{})},$concatArrays:function(t,r){var e=an(t,r,null);return n(a(e)&&2===e.length,"$concatArrays expression must resolve to an array of 2 elements"),e.some(p)?null:e[0].concat(e[1])},$filter:function(t,r){var e=an(t,r.input),u=r.as,i=r.cond;return n(a(e),"$filter 'input' expression must resolve to an array"),e.filter(function(n){var t={};return t["$"+u]=n,!0===an(t,i)})},$in:function(t,r){var e=an(t,r[0]),u=an(t,r[1]);return n(a(u),"$in second argument must be an array"),$(u,e)},$indexOfArray:function(t,r){var e=an(t,r);if(p(e))return null;var u=e[0];if(p(u))return null;n(a(u),"$indexOfArray expression must resolve to an array.");var i=e[1];if(p(i))return null;var o=e[2]||0,s=e[3]||u.length;return s<u.length&&(u=u.slice(o,s)),u.indexOf(i,o)},$isArray:function(n,t){return a(an(n,t))},$map:function(t,r){var e=an(t,r.input);n(a(e),"$map 'input' expression must resolve to an array");var u=r.as,i=r.in,o="$"+u,s=t[o];return E(e,function(n){t[o]=n;var r=an(t,i);return g(s)?delete t[o]:t[o]=s,r})},$objectToArray:function(t,r){var e=an(t,r);n(c(e),"$objectToArray expression must resolve to an object");var u=[];return A(e,function(n,t){return u.push({k:t,v:n})}),u},$range:function(n,t){for(var r=an(n,t),e=r[0],u=r[1],i=r[2]||1,o=[];e<u&&i>0||e>u&&i<0;)o.push(e),e+=i;return o},$reduce:function(t,r){var e=an(t,r.input),u=an(t,r.initialValue),i=r.in;return p(e)?null:(n(a(e),"$reduce 'input' expression must resolve to an array"),S(e,function(n,t){return an({$value:n,$this:t},i)},u))},$reverseArray:function(t,r){var e=an(t,r);if(p(e))return null;n(a(e),"$reverseArray expression must resolve to an array");var u=[];return L(u,e),u.reverse(),u},$size:function(n,t){var r=an(n,t);return a(r)?r.length:void 0},$slice:function(n,t){var r=an(n,t);return sn(r[0],r[1],r[2])},$zip:function(t,r){var e=an(t,r.inputs),i=r.useLongestLength||!1;n(a(e),"'inputs' expression must resolve to an array"),n(u(i),"'useLongestLength' must be a boolean"),a(r.defaults)&&n(m(i),"'useLongestLength' must be set to true to use 'defaults'");for(var o=0,s=0,c=e.length;s<c;s++){var f=e[s];if(p(f))return null;n(a(f),"'inputs' expression values must resolve to an array or null"),o=i?Math.max(o,f.length):Math.min(o||f.length,f.length)}for(var l=[],v=r.defaults||[],h=0;h<o;h++)!function(n){var t=e.map(function(t,r){return p(t[n])?v[r]||null:t[n]});l.push(t)}(h);return l}},Ln={$and:function(n,t){var r=an(n,t);return m(r)&&r.every(m)},$or:function(n,t){var r=an(n,t);return m(r)&&r.some(m)},$not:function(n,t){return!an(n,t[0])}},Bn={$cmp:function(n,t){var r=an(n,t);return r[0]>r[1]?1:r[0]<r[1]?-1:0}};A(["$eq","$ne","$gt","$gte","$lt","$lte","$in","$nin"],function(n){Bn[n]=function(t,r){var e=an(t,r);return Cn[n](e[0],e[1])}});var Yn={$cond:function(t,r){var e=void 0,u=void 0,i=void 0;return a(r)?(n(3===r.length,"Invalid arguments for $cond operator"),e=r[0],u=r[1],i=r[2]):c(r)&&(e=r.if,u=r.then,i=r.else),an(t,e)?an(t,u,null):an(t,i)},$switch:function(t,r){n(r.branches,"Invalid arguments for $switch operator");var e=r.branches.find(function(r){return n(r.case&&r.then,"Invalid arguments for $switch operator"),an(t,r.case)});return e?an(t,e.then):r.default?an(t,r.default):void w("Invalid arguments for $switch operator")},$ifNull:function(t,r){n(a(r)&&2===r.length,"Invalid arguments for $ifNull operator");var e=an(t,r);return null===e[0]||void 0===e[0]?e[1]:e[0]}},Jn={"%Y":["$year",4],"%m":["$month",2],"%d":["$dayOfMonth",2],"%H":["$hour",2],"%M":["$minute",2],"%S":["$second",2],"%L":["$millisecond",3],"%j":["$dayOfYear",3],"%w":["$dayOfWeek",1],"%U":["$week",2],"%%":"%"},zn={$dayOfYear:function(n,t){var r=an(n,t);if(l(r)){var e=new Date(r.getFullYear(),0,0),u=r-e;return Math.round(u/864e5)}},$dayOfMonth:function(n,t){var r=an(n,t);return l(r)?r.getDate():void 0},$dayOfWeek:function(n,t){var r=an(n,t);return l(r)?r.getDay()+1:void 0},$year:function(n,t){var r=an(n,t);return l(r)?r.getFullYear():void 0},$month:function(n,t){var r=an(n,t);return l(r)?r.getMonth()+1:void 0},$week:function(n,t){var r=an(n,t);r=new Date(+r),r.setHours(0,0,0),r.setDate(r.getDate()+4-(r.getDay()||7));var e=new Date(r.getFullYear(),0,1);return Math.floor(((r-e)/864e5+1)/7)},$hour:function(n,t){var r=an(n,t);return l(r)?r.getUTCHours():void 0},$minute:function(n,t){var r=an(n,t);return l(r)?r.getMinutes():void 0},$second:function(n,t){var r=an(n,t);return l(r)?r.getSeconds():void 0},$millisecond:function(n,t){var r=an(n,t);return l(r)?r.getMilliseconds():void 0},$dateToString:function(n,t){for(var r=t.format,e=an(n,t.date),u=r.match(/(%%|%Y|%m|%d|%H|%M|%S|%L|%j|%w|%U)/g),i=0,o=u.length;i<o;i++){var s=Jn[u[i]],c=s;if(a(s)){var f=this[s[0]],l=s[1];c=Q(f.call(this,n,e),l)}r=r.replace(u[i],c)}return r}},Gn={$literal:function(n,t){return t}},Hn={$setEquals:function(n,t){var r=an(n,t),e=P(r[0]),u=P(r[1]);return e.length===u.length&&e.length===I(e,u).length},$setIntersection:function(n,t){var r=an(n,t);return I(r[0],r[1])},$setDifference:function(n,t){var r=an(n,t);return r[0].filter(y.bind(null,r[1]))},$setUnion:function(n,t){var r=an(n,t);return T(r[0],r[1])},$setIsSubset:function(n,t){var r=an(n,t);return I(r[0],r[1]).length===r[0].length},$anyElementTrue:function(n,t){return an(n,t)[0].some(m)},$allElementsTrue:function(n,t){return an(n,t)[0].every(m)}},Qn={$concat:function(n,t){var r=an(n,t);return[null,void 0].some($.bind(null,r))?null:r.join("")},$indexOfBytes:function(t,r){var e=an(t,r);if(p(e[0]))return null;n(i(e[0]),"$indexOfBytes first operand must resolve to a string"),n(i(e[1]),"$indexOfBytes second operand must resolve to a string");var u=e[0],a=e[1],s=e[2],c=e[3]
;if(n(p(s)||o(s)&&s>=0&&Math.round(s)===s,"$indexOfBytes third operand must resolve to a non-negative integer"),s=s||0,n(p(c)||o(c)&&c>=0&&Math.round(c)===c,"$indexOfBytes fourth operand must resolve to a non-negative integer"),c=c||u.length,s>c)return-1;var f=u.substring(s,c).indexOf(a);return f>-1?f+s:f},$split:function(t,e){var u=an(t,e);return n(i(u[0]),"$split requires an expression that evaluates to a string as a first argument, found: "+r(u[0])),n(i(u[1]),"$split requires an expression that evaluates to a string as a second argument, found: "+r(u[1])),u[0].split(u[1])},$strcasecmp:function(n,t){var r=an(n,t);return r[0]=_(r[0])?"":r[0].toUpperCase(),r[1]=_(r[1])?"":r[1].toUpperCase(),r[0]>r[1]?1:r[0]<r[1]?-1:0},$substr:function(n,t){var r=an(n,t);return i(r[0])?r[1]<0?"":r[2]<0?r[0].substr(r[1]):r[0].substr(r[1],r[2]):""},$toLower:function(n,t){var r=an(n,t);return _(r)?"":r.toLowerCase()},$toUpper:function(n,t){var r=an(n,t);return _(r)?"":r.toUpperCase()}},Vn={$let:function(n,t){var r=t.vars,e=t.in,u={},i=j(r);A(i,function(t){var e=an(n,r[t]),i="$"+t;u[i]=n[i],n[i]=e});var o=an(n,e);return A(i,function(t){var r="$"+t;g(u[r])?delete n[r]:n[r]=u[r]}),o}},Kn=Object.assign({},Fn,Un,Ln,Bn,Yn,zn,Gn,Hn,Qn,Vn),Wn={aggregate:Kn,group:Mn,pipeline:En,projection:An,query:Dn},Xn={key:"_id"},Zn={$$ROOT:function(n,t,r){return r.root},$$CURRENT:function(n,t,r){return n}},nt={$$KEEP:function(n){return n},$$PRUNE:function(){},$$DESCEND:function(n,t,r){if(!O(t,"$cond"))return n;var e=void 0;return A(n,function(u,i){f(u)&&(a(u)?(e=[],A(u,function(n){c(n)&&(n=fn(n,t,r)),p(n)||e.push(n)})):e=fn(u,t,r),p(e)?delete n[i]:n[i]=e)}),n}},tt=j(Zn),rt=j(nt);return{_internal:ln,Aggregator:qn,CollectionMixin:{query:function(n,t){return new Rn(n).find(this.toJSON(),t)},aggregate:function(n){return new qn(n).run(this.toJSON())}},Cursor:Pn,OP_AGGREGATE:On,OP_GROUP:wn,OP_PIPELINE:"pipeline",OP_PROJECTION:jn,OP_QUERY:kn,Query:Rn,VERSION:"1.3.3",addOperators:K,aggregate:z,find:G,remove:H,setup:W}});
//# sourceMappingURL=dist/mingo.map
